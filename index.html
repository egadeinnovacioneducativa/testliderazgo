<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad: Liderazgo Consciente</title>
    <!-- Incluimos Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fondo gris claro */
        }
        
        .screen {
            display: none; /* Ocultar todas las pantallas por defecto */
            width: 100%;
        }

        /* Estilo para la pantalla activa */
        .screen.active {
            display: block;
        }

        /* Estilo para las opciones de respuesta */
        .option-card {
            border: 2px solid #e5e7eb; /* Borde gris */
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }

        .option-card:hover {
            border-color: #3b82f6; /* Borde azul al pasar el ratón */
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Estilo para opciones deshabilitadas (prevenir doble clic) */
        .option-card.disabled {
            pointer-events: none;
            opacity: 0.7;
            background-color: #f9fafb;
        }

        /* Estilo para la barra de progreso */
        .progress-bar-container {
            background-color: #e5e7eb;
            border-radius: 9999px;
            height: 8px;
        }

        .progress-bar {
            background-color: #3b82f6;
            height: 100%;
            border-radius: 9999px;
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-3xl bg-white rounded-xl shadow-2xl overflow-hidden">

        <!-- Pantalla 1: Bienvenida y Nombre -->
        <div id="screen-welcome" class="screen active p-8 md:p-12 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Actividad de Liderazgo Consciente</h1>
            <p class="text-lg text-gray-600 mb-8">Por favor, introduce tus datos para comenzar.</p>
            <form id="name-form">
                <input type="text" id="user-name" class="w-full max-w-md mx-auto px-4 py-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Escribe tu nombre completo" required>
                <!-- Campo nuevo para Matrícula -->
                <input type="text" id="user-matricula" class="mt-4 w-full max-w-md mx-auto px-4 py-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Escribe tu Matrícula" required>
                
                <button type="submit" class="mt-6 w-full max-w-md mx-auto bg-blue-600 text-white text-lg font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-300">
                    Comenzar
                </button>
            </form>
        </div>

        <!-- Pantalla 2: Instrucciones -->
        <div id="screen-instructions" class="screen p-8 md:p-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Instrucciones</h2>
            <div class="prose prose-lg text-gray-700 max-w-none">
                <p>Lee cuidadosamente cada una de las siguientes afirmaciones y selecciona la que más se asemeje a tu forma de pensar. Es vital que contestes los cinco niveles.</p>
                <p>Ten en cuenta que solo puedes realizar esta actividad una vez. Recuerda revisar los detalles completos de la actividad en Canvas.</p>
                <p class="font-semibold mt-4">Al finalizar la actividad, se te proporcionará un reporte con tus respuestas. Asegúrate de tomar una captura de pantalla de esta información, ya que será parte de tu entregable.</p>
            </div>
            <button id="start-quiz-btn" class="mt-8 w-full bg-blue-600 text-white text-lg font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-300">
                Entendido, ¡iniciar actividad!
            </button>
        </div>

        <!-- Pantalla 3: Cuestionario -->
        <div id="screen-quiz" class="screen p-8 md:p-12">
            <!-- Barra de progreso -->
            <div class="mb-6">
                <p class="text-sm font-medium text-gray-600 mb-2" id="progress-text">Pregunta 1 de 5</p>
                <div class="progress-bar-container w-full">
                    <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
                </div>
            </div>

            <!-- Contenedor de la pregunta -->
            <div id="question-container">
                <h2 id="question-category" class="text-2xl font-bold text-gray-800 mb-6"></h2>
                <div id="options-container" class="space-y-4">
                    <!-- Las opciones se generarán con JavaScript -->
                </div>
            </div>
        </div>

        <!-- Pantalla 4: Reporte Final -->
        <div id="screen-report" class="screen p-8 md:p-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">Reporte de Respuestas</h2>
            
            <!-- Nivel de Clasificación (Modificado: enmarcado) -->
            <h3 id="report-level" class="text-2xl font-bold text-blue-700 mb-6 text-center border-4 border-blue-500 rounded-lg p-4 bg-blue-50"></h3>
            
            <p class="text-lg text-gray-600 mb-2">¡Gracias por completar la actividad, <span id="report-user-name" class="font-bold"></span>!</p>
            <p class="text-gray-700 mb-8">A continuación, se muestra un resumen de las afirmaciones que seleccionaste.</p>

            <!-- Mensaje Notorio (Nuevo) -->
            <div class="bg-blue-700 text-white p-4 rounded-lg text-center font-semibold text-lg mt-6 mb-8">
                <p>Esencial que captures una imagen de tu resultado, ya que formará parte del entregable. Posteriormente, revisa en qué consiste la segunda parte de la actividad en Canvas.</p>
            </div>
            
            <div id="report-summary" class="space-y-4 border-t border-b border-gray-200 py-6">
                <!-- El resumen de respuestas se generará con JavaScript -->
            </div>

            <button id="submit-btn" class="mt-8 w-full bg-blue-600 text-white text-lg font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-300" disabled>
                Enviando datos...
            </button>
            <p id="submit-status" class="text-sm text-gray-500 mt-4 text-center"></p>

        </div>
    </div>

    <script>
        // --- INICIO: Lógica de la Aplicación ---

        // (IMPORTANTE) URL de Google Apps Script
        // Esta es la URL que proporcionaste
        const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbxjFQHFhNp9UMry2NM55qtWHIgV9BQwhh1oB2iXanAYCB0bBFRKX5pzl1js9Xv7QObL/exec';


        // 1. Definición de Datos del Cuestionario
        const quizData = [
            {
                category: "Categoría 1: Principios de Liderazgo Consciente",
                options: [
                    { text: "Un ejemplo de un liderazgo consciente sería Satya Nadella, CEO de Microsoft, conocido por su enfoque en la empatía, la innovación inclusiva y la transformación cultural dentro de la empresa.", points: 200 }, // 100 * 2
                    { text: "El liderazgo consciente es un enfoque que combina la conciencia personal con la responsabilidad social, enfocándose en la creación de valor sostenible a largo plazo. Se centra en la empatía, la ética y el bienestar colectivo.", points: 400 }, // 200 * 2
                    { text: "Un líder consciente puede influir en la cultura organizacional promoviendo valores como la transparencia, la equidad y la inclusión, y al modelar comportamientos que otros en la organización aspiren a seguir.", points: 600 }, // 300 * 2
                    { text: "Son dos principios fundamentales del liderazgo consciente: 1. Autoconciencia que permite conocer y entender las propias emociones, valores y motivaciones; 2. Empatía es la capacidad de entender y compartir los sentimientos de los demás.", points: 800 }  // 400 * 2
                ]
            },
            {
                category: "Categoría 2: Inteligencia Emocional",
                options: [
                    { text: "La inteligencia emocional es la capacidad de reconocer y manejar nuestras propias emociones y las de los demás. Es crucial en el liderazgo consciente porque permite a los líderes conectar genuinamente con sus equipos y tomar decisiones más informadas y empáticas.", points: 200 },
                    { text: "Los cuatro componentes principales de la inteligencia emocional según Daniel Goleman son: Autoconciencia, autorregulación, motivación, empatía y habilidades sociales.", points: 400 },
                    { text: "Una situación en la que un líder utilizó la inteligencia emocional para resolver un conflicto se da de manera natural porque manejó un conflicto entre dos empleados al reconocer sus propias emociones y las de los involucrados, promoviendo una conversación abierta y empática que llevó a una resolución que todos consideraron justa.", points: 600 },
                    { text: "La inteligencia emocional puede desarrollarse a nivel personal, mediante prácticas desde el punto de vista físico, como la meditación y la autoreflexión, mientras que a nivel organizacional se implementan programas de capacitación y se fomenta una cultura de feedback constante.", points: 800 }
                ]
            },
            {
                category: "Categoría 3: Comunicación Empática",
                options: [
                    { text: "La comunicación empática es la habilidad de escuchar y comprender activamente las perspectivas y emociones de los demás. Es crucial porque construye confianza y fortalece las relaciones dentro del equipo.", points: 200 },
                    { text: "A continuación, se mencionan dos técnicas de comunicación empática. 1. Escucha activa es mostrar atención genuina y responder de manera reflexiva y 2. La validación emocional que es reconocer y respetar los sentimientos y emociones de los otros sin juzgar.", points: 400 },
                    { text: "Los retos que un líder puede enfrentar al implementar comunicación empática en un equipo diverso existen porque puede haber barreras culturales y lingüísticas, así como diferentes estilos de comunicación y niveles de apertura emocional, un líder debe ser adaptable y sensible a estas diferencias.", points: 600 },
                    { text: "Un escenario donde la comunicación empática mejoró el desempeño de un equipo es porque un líder usó esa acción con la finalidad de entender las preocupaciones de su equipo sobre una nueva política o una determinada forma de trabajar. Al validar sus emociones y discutir abiertamente, los empleados se sintieron escuchados y colaboraron más eficazmente en la implementación.", points: 800 }
                ]
            },
            {
                category: "Categoría 4: Toma de Decisiones Éticas",
                options: [
                    { text: "Tomar decisiones éticas no solo considera el beneficio propio o empresarial, sino también el impacto en las personas, la sociedad y el medio ambiente.", points: 200 },
                    { text: "Existe un modelo de toma de decisiones que hace referencia a los Cuatro Cuadrantes, que considera la legalidad, equidad, resultados y beneficios a largo plazo, que puede ser utilizado por una persona que ejerce un liderazgo consciente.", points: 400 },
                    { text: "Una situación en la que un líder haya tomado una decisión ética difícil se observa cuando un líder decide rechazar un contrato lucrativo porque implicaba prácticas laborales injustas, esta decisión con el paso del tiempo, fortaleció la reputación de la empresa y atrajo clientes que valoran la ética.", points: 600 },
                    { text: "Un líder consciente puede fomentar un ambiente que promueva la toma de decisiones éticas entre los miembros del equipo al establecer un código de conducta claro, liderando con el ejemplo, proporcionando formación ética con la finalidad de crear un entorno en el que se fomente la transparencia y se valoren las decisiones éticas.", points: 800 }
                ]
            },
            {
                category: "Categoría 5: Estrategias de Inclusión y Diversidad",
                options: [
                    { text: "Inclusión se refiere a crear un entorno donde todas las personas se sientan valoradas y respetadas. Diversidad se refiere a la presencia de diferencias entre los miembros del equipo, incluyendo género, raza, orientación sexual, y más.", points: 200 },
                    { text: "Mejora de la creatividad e innovación y aumento de la satisfacción y retención de empleados.", points: 400 },
                    { text: "Implementar procesos de contratación inclusivos que eliminen sesgos y promuevan la participación de candidatos diversos.", points: 600 },
                    { text: "El caso de IBM, que, al adoptar políticas de diversidad e inclusión, logró innovaciones significativas y una mejor adaptación a mercados globales variados.", points: 800 }
                ]
            }
        ];

        // 2. Estado de la Aplicación
        let currentQuestionIndex = 0;
        let userAnswers = {}; // Almacenará { category: { text, points } }
        let userName = "";
        let userMatricula = ""; // (Nuevo)

        // 3. Referencias a Elementos del DOM
        const screens = document.querySelectorAll('.screen');
        const nameForm = document.getElementById('name-form');
        const userNameInput = document.getElementById('user-name');
        const userMatriculaInput = document.getElementById('user-matricula'); // (Nuevo)
        const startQuizBtn = document.getElementById('start-quiz-btn');
        
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar');
        const questionCategory = document.getElementById('question-category');
        const optionsContainer = document.getElementById('options-container');

        const reportUserName = document.getElementById('report-user-name');
        const reportLevel = document.getElementById('report-level');
        const reportSummary = document.getElementById('report-summary');
        const submitBtn = document.getElementById('submit-btn');
        const submitStatus = document.getElementById('submit-status');

        // 4. Funciones Principales

        /**
         * Muestra una pantalla específica por su ID y oculta las demás.
         * @param {string} screenId - El ID de la pantalla a mostrar (ej. "screen-welcome")
         */
        function showScreen(screenId) {
            screens.forEach(screen => {
                if (screen.id === screenId) {
                    screen.classList.add('active');
                } else {
                    screen.classList.remove('active');
                }
            });
        }

        /**
         * Inicia el juego: guarda el nombre y matrícula, y muestra las instrucciones.
         */
        function startGame(event) {
            event.preventDefault(); // Evitar que el formulario recargue la página
            userName = userNameInput.value.trim();
            userMatricula = userMatriculaInput.value.trim(); // (Nuevo)
            
            if (userName && userMatricula) {
                showScreen('screen-instructions');
            } else {
                alert("Por favor, completa todos los campos.");
            }
        }

        /**
         * Muestra la pregunta actual en la pantalla.
         */
        function renderQuestion() {
            if (currentQuestionIndex < quizData.length) {
                const question = quizData[currentQuestionIndex];
                
                // Actualizar barra de progreso
                const progressPercentage = ((currentQuestionIndex + 1) / quizData.length) * 100;
                progressText.textContent = `Pregunta ${currentQuestionIndex + 1} de ${quizData.length}`;
                progressBar.style.width = `${progressPercentage}%`;

                // Mostrar categoría y opciones
                questionCategory.textContent = question.category;
                optionsContainer.innerHTML = ''; // Limpiar opciones anteriores

                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option-card p-4 rounded-lg shadow-sm cursor-pointer';
                    optionElement.innerHTML = `<p class="text-gray-700">${option.text}</p>`;
                    
                    // Añadir evento de clic
                    optionElement.addEventListener('click', () => selectAnswer(question.category, option));
                    optionsContainer.appendChild(optionElement);
                });

            } else {
                // Fin del cuestionario
                showReport();
            }
        }

        /**
         * Registra la respuesta del usuario y avanza a la siguiente pregunta.
         * @param {string} category - La categoría de la pregunta
         * @param {object} option - El objeto de opción seleccionado ({ text, points })
         */
        function selectAnswer(category, option) {
            // (NUEVO) Deshabilitar todas las opciones para evitar doble clic
            const allOptions = optionsContainer.querySelectorAll('.option-card');
            allOptions.forEach(opt => opt.classList.add('disabled'));

            // Guardar la respuesta
            userAnswers[category] = {
                text: option.text,
                points: option.points
            };

            // Avanzar a la siguiente pregunta después de una breve pausa
            setTimeout(() => {
                currentQuestionIndex++;
                renderQuestion();
            }, 300); // 300ms de pausa
        }

        /**
         * Calcula el puntaje total.
         * @returns {number} - El puntaje total
         */
        function calculateScore() {
            let totalScore = 0;
            for (const category in userAnswers) {
                totalScore += userAnswers[category].points;
            }
            return totalScore;
        }

        /**
         * Obtiene la clasificación basada en el puntaje.
         * @param {number} score - El puntaje total
         * @returns {string} - El texto de la clasificación
         */
        function getClassification(score) {
            if (score <= 1000) {
                return "Nivel Principiante: Conoce los conceptos básicos y muestra una comprensión inicial de los principios del liderazgo consciente.";
            } else if (score <= 2000) {
                return "Nivel Intermedio: Muestra una comprensión sólida y puede aplicar los principios del liderazgo consciente en situaciones simuladas y menos complejas.";
            } else if (score <= 3000) {
                return "Nivel Avanzado: Demuestra competencias avanzadas, puede aplicar el liderazgo consciente en situaciones más complejas y muestra habilidades de reflexión y adaptación.";
            } else { // 3001 - 4000
                return "Nivel Experto: Exhibe un dominio completo del liderazgo consciente, aplica principios en contextos variados y proporciona liderazgo transformacional en su entorno.";
            }
        }

        /**
         * Muestra la pantalla de reporte final.
         */
        function showReport() {
            const totalScore = calculateScore();
            const classification = getClassification(totalScore);

            // Rellenar la pantalla de reporte
            reportUserName.textContent = userName;
            reportLevel.textContent = classification; // Mostrar la clasificación completa

            // Rellenar el resumen de respuestas
            reportSummary.innerHTML = ''; // Limpiar
            for (const category in userAnswers) {
                const answer = userAnswers[category];
                const summaryElement = document.createElement('div');
                summaryElement.className = 'py-2';
                summaryElement.innerHTML = `
                    <h4 class="font-semibold text-gray-800">${category}</h4>
                    <p class="text-gray-600 text-sm">${answer.text}</p>
                `;
                reportSummary.appendChild(summaryElement);
            }
            
            // Mostrar la pantalla
            showScreen('screen-report');

            // Enviar datos a Google Sheet automáticamente
            submitToGoogleSheet({
                nombre: userName,
                matricula: userMatricula, // (Nuevo)
                puntuacionTotal: totalScore,
                nivel: classification,
                respuestas: userAnswers
            });
        }

        /**
         * Envía los datos finales a Google Apps Script.
         * @param {object} data - Los datos a enviar
         */
        async function submitToGoogleSheet(data) {
            
            // VALIDACIÓN (Nuevo): Verificar que la URL fue cambiada
            if (appsScriptUrl === 'URL_DE_TU_GOOGLE_APPS_SCRIPT_WEB_APP_AQUI') {
                console.error("Error: La URL de Google Apps Script no ha sido configurada.");
                
                // (NUEVO) Añadir feedback al usuario y detener la función
                submitBtn.disabled = false; // Habilitar para reintentar
                submitBtn.textContent = 'Error de Configuración';
                submitStatus.textContent = 'Error: La URL del script no está configurada. Contacta al administrador.';
                submitStatus.className = 'text-sm text-red-600 mt-4 text-center';
                return; // Detener la función
            }

            // Opcional: registrar en consola lo que se envía
            console.log("Enviando a Google Sheets...", data);

            try {
                const response = await fetch(appsScriptUrl, {
                    method: 'POST',
                    mode: 'no-cors', // Importante para Google Apps Script
                    headers: {
                        'Content-Type': 'text/plain', // Usar text/plain para no-cors
                    },
                    body: JSON.stringify(data) // El script de Google lo parseará
                });
                
                // Nota: con 'no-cors', no podemos leer la respuesta.
                // Asumimos éxito si el 'fetch' no lanza un error de red.
                
                console.log("Datos enviados (modo no-cors)");
                submitBtn.textContent = 'Datos Enviados Correctamente';
                submitBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                submitBtn.classList.add('bg-green-600'); // Color verde
                submitStatus.textContent = '¡Tu información ha sido registrada!';
                submitStatus.className = 'text-sm text-green-700 mt-4 text-center';

            } catch (error) {
                console.error("Error al intentar enviar los datos:", error);
                
                submitBtn.disabled = false; // Habilitar para reintentar
                submitBtn.textContent = 'Reintentar Envío';
                submitBtn.classList.add('bg-red-600', 'hover:bg-red-700'); // Color rojo
                submitStatus.textContent = `Error al enviar: ${error.message}. Por favor, verifica tu conexión e inténtalo de nuevo.`;
                submitStatus.className = 'text-sm text-red-600 mt-4 text-center';
            }
        }


        // 5. Asignación de Eventos
        nameForm.addEventListener('submit', startGame);
        startQuizBtn.addEventListener('click', () => {
            showScreen('screen-quiz');
            renderQuestion();
        });

        // Evento para el botón de reintento (en caso de que falle el envío)
        submitBtn.addEventListener('click', () => {
            if (submitBtn.textContent === 'Reintentar Envío') {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Enviando datos...';
                
                // Re-calcular y re-enviar
                const totalScore = calculateScore();
                const classification = getClassification(totalScore);
                submitToGoogleSheet({
                    nombre: userName,
                    matricula: userMatricula,
                    puntuacionTotal: totalScore,
                    nivel: classification,
                    respuestas: userAnswers
                });
            }
        });

        // --- FIN: Lógica de la Aplicación ---
    </script>
</body>
</html>
